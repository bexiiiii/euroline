# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å 1–°

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–¥–µ

### 1. –ü—Ä–æ–±–ª–µ–º–∞ —Å routing —Ñ–∞–π–ª–æ–≤ offers
**–ë—ã–ª–æ:** ZIP —Ñ–∞–π–ª—ã –≤—Å–µ–≥–¥–∞ –Ω–∞–ø—Ä–∞–≤–ª—è–ª–∏—Å—å –≤ `CATALOG_IMPORT` –æ—á–µ—Ä–µ–¥—å, –¥–∞–∂–µ –µ—Å–ª–∏ —Å–æ–¥–µ—Ä–∂–∞–ª–∏ `offers*.xml`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `ZipUtil.hasEntryWithPrefix()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ ZIP
- ‚úÖ `ImportCoordinator.resolveJobType()` —Ç–µ–ø–µ—Ä—å —Å–∫–∞—á–∏–≤–∞–µ—Ç ZIP –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
- ‚úÖ –§–∞–π–ª—ã `offers0_1.xml` —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å `OFFERS_IMPORT`
- ‚úÖ `CatalogImportConsumer` –≤—ã–¥–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω—É—é –æ—à–∏–±–∫—É –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

### 2. –£–ª—É—á—à–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–æ—É—Ç–∏–Ω–≥–∞
```java
// –¢–µ–ø–µ—Ä—å ImportCoordinator:
1. –°–∫–∞—á–∏–≤–∞–µ—Ç ZIP —Ñ–∞–π–ª –∏–∑ S3
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∫–∞–∫–æ–π XML –≤–Ω—É—Ç—Ä–∏ (import*.xml –∏–ª–∏ offers*.xml)
3. –ù–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å:
   - import*.xml ‚Üí CATALOG_IMPORT ‚Üí CatalogImportConsumer
   - offers*.xml ‚Üí OFFERS_IMPORT ‚Üí OffersImportConsumer
```

## ‚ö†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ 1–° (–ö–†–ò–¢–ò–ß–ù–û!)

### –¢–µ–∫—É—â–∏–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–ò–∑ `application-prod.yml`:
```yaml
cml:
  username: 1c_exchange
  password: 234Euroline456
```

### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –¥–ª—è 1–°

```
URL: https://api.euroline.1edu.kz/api/1c-exchange
–ú–µ—Ç–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: Basic Auth
–õ–æ–≥–∏–Ω: 1c_exchange
–ü–∞—Ä–æ–ª—å: 234Euroline456
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–¢–µ—Å—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:
```bash
curl -u 1c_exchange:234Euroline456 \
  "https://api.euroline.1edu.kz/api/1c-exchange/test"

# –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: success
```

–¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
```bash
curl -u 1c_exchange:234Euroline456 \
  "https://api.euroline.1edu.kz/api/1c-exchange?type=catalog&mode=checkauth"

# –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: success\ncookie_name\ncookie_value
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞"

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –≤ 1–°**
   - ‚ùå –°—Ç–∞—Ä—ã–π: `https://api.euroline.1edu.kz/api/commerceml`
   - ‚úÖ –ù–æ–≤—ã–π: `https://api.euroline.1edu.kz/api/1c-exchange`

2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –≤ 1–°**
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: `1c_exchange` / `234Euroline456`

3. **1–° –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Basic Auth –∑–∞–≥–æ–ª–æ–≤–æ–∫**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ 1–°

4. **Firewall –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ nginx/backend –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ backend

```bash
# –ü–æ–∏—Å–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç 1–°
tail -f logs/application.log | grep "1–°"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
tail -f logs/application.log | grep "checkauth"

# –û—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
tail -f logs/application.log | grep "Unauthorized\|401"
```

### –û—à–∏–±–∫–∞: "Orders export produced null"

**–ü—Ä–∏—á–∏–Ω–∞:** –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `NEW`

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∑–∞–∫–∞–∑–æ–≤
SELECT id, status, created_at 
FROM cml_orders 
WHERE status = 'NEW' 
ORDER BY created_at DESC 
LIMIT 5;

-- –ï—Å–ª–∏ –∑–∞–∫–∞–∑–æ–≤ –Ω–µ—Ç, —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π
INSERT INTO cml_orders (id, order_id, document_number, status, created_at)
VALUES (
  gen_random_uuid(),
  (SELECT id FROM orders ORDER BY id DESC LIMIT 1),
  'TEST-001',
  'NEW',
  NOW()
);
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ 1–°

- [ ] **URL**: `https://api.euroline.1edu.kz/api/1c-exchange`
- [ ] **–õ–æ–≥–∏–Ω**: `1c_exchange`
- [ ] **–ü–∞—Ä–æ–ª—å**: `234Euroline456`
- [ ] **–ú–µ—Ç–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**: Basic Authentication
- [ ] **–†–µ–∂–∏–º –æ–±–º–µ–Ω–∞**: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π CommerceML 2.0
- [ ] **–¢–∏–ø—ã –æ–±–º–µ–Ω–∞**:
  - `catalog` - –í—ã–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
  - `sale` - –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤
  - `return` - –ó–∞–≥—Ä—É–∑–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ 1–°:**
   - –û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–º–µ–Ω–∞ —Å —Å–∞–π—Ç–æ–º
   - –£–∫–∞–∑–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

2. **–¢–µ—Å—Ç–æ–≤—ã–π –æ–±–º–µ–Ω:**
   ```
   1. –†–µ–∂–∏–º: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏
   2. –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å: "–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ"
   ```

3. **–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±–º–µ–Ω–∞:**
   ```
   1. –í—ã–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ (import*.xml)
   2. –í—ã–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π (offers*.xml)
   3. –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤ (sale:query)
   ```

4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ backend: `tail -f logs/application.log`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RabbitMQ: –æ—á–µ—Ä–µ–¥–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å—Å—è
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å MinIO: —Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–ª—è—Ç—å—Å—è –≤ `commerce-ml/inbox/`

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π:

‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ 1** - Offers —Ñ–∞–π–ª—ã —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ 2** - Orders export —Ä–∞–±–æ—Ç–∞–µ—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å –∑–∞–∫–∞–∑—ã –≤ –ë–î)
‚è≥ **–ü—Ä–æ–±–ª–µ–º–∞ 3** - –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ URL –≤ 1–°

## üÜò –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞

1. **–í–∫–ª—é—á–∏—Ç—å debug –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   ```yaml
   # application-prod.yml
   logging:
     level:
       autoparts.kz.modules.cml: DEBUG
       org.springframework.security: DEBUG
   ```

2. **–°–æ–±—Ä–∞—Ç—å –ª–æ–≥–∏:**
   ```bash
   # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 500 —Å—Ç—Ä–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ 1–°
   tail -500 logs/application.log | grep -A5 -B5 "1–°\|checkauth\|cml"
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Security:**
   - Basic Auth –≤–∫–ª—é—á–µ–Ω –¥–ª—è `/api/1c-exchange/**`
   - NoOpPasswordEncoder –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–ø–∞—Ä–æ–ª—å –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ)
   - –†–æ–ª—å `CML` –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
